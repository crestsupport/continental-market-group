<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Real Estate Stress Tester</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .content-wrapper {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .nav {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
        }
        .nav a {
            color: #007BFF;
            text-decoration: none;
            font-weight: bold;
            padding: 5px 10px;
            transition: color 0.3s;
        }
        .nav a:hover {
            color: #0056b3;
        }
        section {
            margin-top: 60px; /* Space for fixed nav */
            padding: 1em;
            scroll-margin-top: 60px; /* Offset for smooth scroll */
        }
        h1, h2, h3 {
            color: #333;
        }
        .form-group {
            margin-bottom: 1em;
            text-align: left;
        }
        label {
            display: block;
            margin-bottom: 0.5em;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 0.5em;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        input:disabled, select:disabled {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }
        button, .payment-link a {
            width: 100%;
            padding: 0.75em;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-family: 'Roboto', sans-serif;
        }
        button:disabled, .payment-link a:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        button:hover:not(:disabled), .payment-link a:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .section, #result, .disclaimer, #terms-privacy {
            padding: 1em;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.95);
        }
        #result {
            display: none;
        }
        .error {
            color: red;
            font-size: 0.875em;
            margin-top: 0.5em;
        }
        .price-highlight {
            font-size: 1.2em;
            font-weight: bold;
            color: #d32f2f;
            background-color: #fff9c4;
            padding: 2px 6px;
            border-radius: 3px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
            animation: pulse 1.5s infinite;
        }
        s {
            color: #666;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .flag {
            font-size: 1.5em;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="nav">
        <a href="#home">Home</a>
        <a href="#terms-privacy">Terms & Privacy</a>
        <a href="mailto:catalystcg@outlook.com?subject=Contact%20from%20Real%20Estate%20Stress%20Tester&body=Hello,%20I%20have%20a%20question%20or%20comment:" onclick="this.href='mailto:catalystcg@outlook.com?subject=Contact%20from%20Real%20Estate%20Stress%20Tester&body=Hello,%20I%20have%20a%20question%20or%20comment:'; if (!window.location.href.includes('mailto:')) alert('Please ensure your email client is configured to open mailto links. Contact us at catalystcg@outlook.com manually if needed.');">Contact Us</a>
    </div>
    <div class="content-wrapper">
        <section id="home">
            <h1>Canadian Real Estate Stress Tester ðŸ‡¨ðŸ‡¦</h1>
            <div class="section">
                <h2>About Us</h2>
                <p>We are a data-driven platform powered by AI and machine learning, dedicated to providing impartial real estate assessment tools across Canada. Operated by Continental Market Group, our approach leverages national data up to May 2025 trends from CREA, Statistics Canada, Bank of Canada, and CMHC, factoring in property type (house, condo, townhouse), square footage, province, and postal code-specific pricing to project values. It also considers potential impacts from interest rates and market trends.</p>
                <h3>Ready to Stress Test Your Canadian Property?</h3>
                <p>Pay <span class="price-highlight">$19.99 CAD</span> (regular price: <s>$39.99 CAD</s>, limited time offer) via Stripe to unlock your assessment results.</p>
                <div id="payment">
                    <a href="https://buy.stripe.com/eVqcMN4Ke6PYbtC8u3a7C02" id="checkout-button" class="payment-link" target="_blank">Buy Now ($19.99)</a>
                </div>
            </div>
            <div class="section">
                <h3>Postal Code Input</h3>
                <div class="form-group">
                    <label for="postalCode">Enter Your Postal Code (e.g., M5V 2T6):</label>
                    <input type="text" id="postalCode" name="postalCode" pattern="[A-Za-z]\d[A-Za-z]\s?\d[A-Za-z]\d" placeholder="e.g., M5V 2T6" required>
                    <div class="error" id="postalCodeError"></div>
                </div>
            </div>
            <form id="stressTestForm" onsubmit="assessProperty(event)">
                <div class="form-group">
                    <label for="appraisalPrice">Estimated Appraisal Price ($CAD):</label>
                    <input type="number" id="appraisalPrice" name="appraisalPrice" min="0" required>
                    <div class="error" id="appraisalPriceError"></div>
                </div>
                <div class="form-group">
                    <label for="propertyCategory">Property Category:</label>
                    <select id="propertyCategory" name="propertyCategory" required>
                        <option value="house">House</option>
                        <option value="condo">Condo</option>
                        <option value="townhouse">Townhouse</option>
                    </select>
                    <div class="error" id="propertyCategoryError"></div>
                </div>
                <div class="form-group">
                    <label for="province">Province/Territory:</label>
                    <select id="province" name="province" required>
                        <option value="ON">Ontario</option>
                        <option value="QC">Quebec</option>
                        <option value="NS">Nova Scotia</option>
                        <option value="NB">New Brunswick</option>
                        <option value="MB">Manitoba</option>
                        <option value="BC">British Columbia</option>
                        <option value="PE">Prince Edward Island</option>
                        <option value="SK">Saskatchewan</option>
                        <option value="AB">Alberta</option>
                        <option value="NL">Newfoundland and Labrador</option>
                        <option value="NT">Northwest Territories</option>
                        <option value="YT">Yukon</option>
                        <option value="NU">Nunavut</option>
                    </select>
                    <div class="error" id="provinceError"></div>
                </div>
                <div class="form-group">
                    <label for="bedrooms">Number of Bedrooms:</label>
                    <input type="number" id="bedrooms" name="bedrooms" min="0" required>
                    <div class="error" id="bedroomsError"></div>
                </div>
                <div class="form-group">
                    <label for="bathrooms">Number of Bathrooms:</label>
                    <input type="number" id="bathrooms" name="bathrooms" min="0" required>
                    <div class="error" id="bathroomsError"></div>
                </div>
                <div class="form-group">
                    <label for="squareFootage">Square Footage:</label>
                    <input type="number" id="squareFootage" name="squareFootage" min="0" required>
                    <div class="error" id="squareFootageError"></div>
                </div>
                <div class="form-group">
                    <label for="location">City:</label>
                    <input type="text" id="location" name="location" required>
                    <div class="error" id="locationError"></div>
                </div>
                <button type="submit" id="submitBtn">Calculate 2-Year Outlook</button>
            </form>
            <div id="result"></div>
            <div class="disclaimer">
                <p><strong>Disclaimer:</strong> This tool provides estimates based on national data which may not be up to today's date for informational purposes only. It is not financial, legal, or real estate advice. Results may not reflect real-time local conditions, and we are not liable for decisions based on this tool. Consult a professional for personalized advice.</p>
            </div>
        </section>
        <section id="terms-privacy">
            <h2>Terms & Privacy</h2>
            <h3>Terms of Use</h3>
            <p><strong>Acceptance of Terms:</strong> By accessing or using the Canadian Real Estate Stress Tester ("Service") provided by Continental Market Group ("Company," "we," "us," or "our"), you agree to be bound by these Terms of Use. If you do not agree, please do not use the Service.</p>
            <p><strong>Use of Service:</strong> The Service is intended for personal, non-commercial use. You may not use the Service for any illegal or unauthorized purpose. We reserve the right to terminate or restrict access to the Service at our discretion without notice.</p>
            <p><strong>Payment and Fees:</strong> Access to certain features requires payment via Stripe. All fees are in CAD and non-refundable unless required by law. Pricing is subject to change, and we will notify users of significant changes with reasonable notice.</p>
            <p><strong>Intellectual Property:</strong> All content, including text, graphics, and code, is the property of Continental Market Group and protected by Canadian and international copyright laws. You may not reproduce or distribute any content without our written consent.</p>
            <p><strong>Disclaimer of Warranties:</strong> The Service is provided "as is" without warranties of any kind, either express or implied, including but not limited to accuracy, reliability, or fitness for a particular purpose. We do not guarantee that the Service will be uninterrupted or error-free.</p>
            <p><strong>Limitation of Liability:</strong> To the fullest extent permitted by law, the Company shall not be liable for any indirect, incidental, special, or consequential damages arising from the use or inability to use the Service, including but not limited to financial losses or decisions based on assessment results.</p>
            <p><strong>Modifications:</strong> We may update these Terms of Use at any time. Continued use of the Service after changes constitutes acceptance of the new terms.</p>

            <h3>Privacy Policy</h3>
            <p><strong>Information We Collect:</strong> The Service collects postal code data entered by users, processed in-browser and not stored or transmitted by us. No other personal information (e.g., name, email) is collected unless voluntarily provided via the "Contact Us" link.</p>
            <p><strong>Use of Information:</strong> Any data collected is used solely to provide the Service's functionality (e.g., postal code-based assessments). We do not sell, trade, or share your information with third parties.</p>
            <p><strong>Data Security:</strong> We implement reasonable security measures to protect against unauthorized access or disclosure. However, no online transmission is completely secure, and we cannot guarantee absolute security.</p>
            <p><strong>Cookies and Tracking:</strong> The Service does not use cookies or tracking technologies. Your browser may store temporary data for functionality, which is cleared upon session end.</p>
            <p><strong>Compliance with PIPEDA:</strong> We adhere to the Personal Information Protection and Electronic Documents Act (PIPEDA) by limiting data collection to what is necessary and ensuring transparency in our practices.</p>
            <p><strong>Your Rights:</strong> You may contact us at <a href="mailto:catalystcg@outlook.com">catalystcg@outlook.com</a> to inquire about any data processed or to request its deletion, though minimal data is retained.</p>
            <p><strong>Changes to Privacy Policy:</strong> We may update this policy to reflect changes in our practices. Updates will be posted here, and continued use signifies acceptance.</p>

            <p><strong>Contact Us:</strong> For questions about these Terms or Privacy Policy, email us at <a href="mailto:catalystcg@outlook.com">catalystcg@outlook.com</a>.</p>
        </section>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded and parsed');
            const canvas = document.getElementById('mapCanvas');
            if (canvas) canvas.remove(); // Remove unused canvas element

            const form = document.getElementById('stressTestForm');
            if (form) {
                form.addEventListener('submit', function(event) {
                    console.log('Form submitted, preventing default');
                    event.preventDefault();
                    assessProperty(event);
                });
            } else {
                console.error('Form element not found');
            }

            // National market data with postal code factors (simplified example)
            const marketData = {
                lastUpdated: '2025-06-10',
                nationalTrends: {
                    priceChangeAnnual: -0.036,
                    salesDrop: 0.075,
                    unsoldInventory: 0.143,
                    basePrice: 679
                },
                policyImpact: {
                    interestRate: 0.0275,
                    economicUncertainty: 0.10
                },
                weights: {
                    priceChange: 0.4,
                    salesDrop: 0.3,
                    unsoldInventory: 0.2,
                    policyImpact: 0.1
                },
                postalCodeFactors: {
                    'M5V': 1.2, // Downtown Toronto
                    'V6B': 1.15, // Vancouver
                    'H3B': 1.0,  // Montreal
                    'T2P': 1.05, // Calgary
                    'B3J': 0.95  // Halifax
                    // Add more postal code prefixes as needed
                }
            };

            function assessProperty(event) {
                console.log('assessProperty function called');
                event.preventDefault();

                try {
                    console.log('Attempting to get input values');
                    const appraisalPrice = parseFloat(document.getElementById('appraisalPrice').value);
                    const bedrooms = parseInt(document.getElementById('bedrooms').value);
                    const bathrooms = parseInt(document.getElementById('bathrooms').value);
                    const squareFootage = parseInt(document.getElementById('squareFootage').value);
                    const location = document.getElementById('location').value || 'Unknown';
                    const postalCode = document.getElementById('postalCode').value.toUpperCase().replace(/\s/g, '');
                    const propertyCategory = document.getElementById('propertyCategory').value || 'house';
                    const province = document.getElementById('province').value || 'ON';

                    if (!appraisalPrice || !bedrooms || !bathrooms || !squareFootage || appraisalPrice <= 0 || squareFootage <= 0) {
                        throw new Error('Please enter positive numbers for appraisal price, bedrooms, bathrooms, and square footage.');
                    }

                    if (!postalCode.match(/[A-Za-z]\d[A-Za-z]\d[A-Za-z]\d/)) {
                        throw new Error('Please enter a valid Canadian postal code (e.g., M5V 2T6).');
                    }

                    const postalCodePrefix = postalCode.slice(0, 3);
                    const postalFactor = marketData.postalCodeFactors[postalCodePrefix] || 1.0;

                    // Calculate national market sentiment score (-1 to 1, negative for decline)
                    const nationalData = marketData.nationalTrends;
                    const sentimentScore = (nationalData.priceChangeAnnual * marketData.weights.priceChange) +
                                          (nationalData.salesDrop * marketData.weights.salesDrop * -1) +
                                          (nationalData.unsoldInventory * marketData.weights.unsoldInventory * -1) +
                                          (marketData.policyImpact.economicUncertainty * marketData.weights.policyImpact * -1);
                    const adjustedGrowthRate = sentimentScore * 0.5;

                    const interestRateImpact = 0.01;
                    const roomFactor = (bedrooms + bathrooms * 0.5) / 10;
                    const currentPricePerUnit = nationalData.basePrice * postalFactor * (1 + roomFactor) * (1 - interestRateImpact);
                    const futurePricePerUnit = currentPricePerUnit * Math.pow(1 + adjustedGrowthRate, 2);

                    const currentValue = appraisalPrice;
                    const projectedValue = squareFootage * futurePricePerUnit;
                    const percentageChange = ((projectedValue - currentValue) / currentValue) * 100;

                    console.log('Calculations completed:', { currentValue, projectedValue, percentageChange });

                    let increaseChance, declineChance, outlook;
                    if (percentageChange < -5) {
                        declineChance = Math.min(70 + (Math.abs(percentageChange) - 5), 95);
                        increaseChance = 100 - declineChance;
                        outlook = `Expected value decrease of ${(-percentageChange).toFixed(1)}% over 2 years, driven by national market trends and economic uncertainty.`;
                    } else if (percentageChange > 5) {
                        increaseChance = Math.min(70 + (percentageChange - 5), 95);
                        declineChance = 100 - increaseChance;
                        outlook = `Expected value increase of ${percentageChange.toFixed(1)}% over 2 years, supported by national trends, though tempered by risks.`;
                    } else {
                        increaseChance = 40;
                        declineChance = 60;
                        outlook = `Value expected to decline or remain stable (Â±5%) over 2 years, reflecting current national market conditions.`;
                    }

                    const resultDiv = document.getElementById('result');
                    if (resultDiv) {
                        console.log('Result div found, updating content');
                        resultDiv.style.display = 'block';
                        resultDiv.innerHTML = `
                            <p>Current Value: $${currentValue.toLocaleString()}</p>
                            <p>Projected Value (2 Years): $${projectedValue.toLocaleString()}</p>
                            <p>2-Year Outlook: ${outlook}</p>
                            <p>Price Movement Probability: ${increaseChance}% chance of increase, ${declineChance}% chance of decline</p>
                            <p>Location: ${location} (Postal Code: ${postalCode})</p>
                            <p>Property Type: ${propertyCategory}</p>
                            <p>Province: ${province}</p>
                            <p>Market Data Last Updated: ${marketData.lastUpdated}</p>
                        `;
                        console.log('Result displayed');
                    } else {
                        console.error('Result div not found');
                    }
                } catch (error) {
                    console.log('Error caught:', error.message);
                    const resultDiv = document.getElementById('result');
                    if (resultDiv) {
                        resultDiv.style.display = 'block';
                        resultDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                        console.error('Assessment error displayed:', error);
                    } else {
                        console.error('Result div not found for error display');
                    }
                }
            }

            // Smooth scroll for navigation
            document.querySelectorAll('.nav a').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const href = this.getAttribute('href');
                    if (href.startsWith('mailto:')) {
                        window.location.href = href;
                    } else {
                        const target = document.querySelector(href);
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
