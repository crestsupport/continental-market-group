<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Stress Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        nav { background-color: #333; padding: 10px; }
        nav a { color: white; margin: 0 15px; text-decoration: none; }
        nav a:hover { text-decoration: underline; }
        .content { max-width: 800px; margin: 20px auto; padding: 20px; }
        .form-group { margin: 20px 0; }
        input, select, button { padding: 10px; margin: 5px 0; }
        .section { display: none; margin-top: 20px; }
        #postalCodeError, #appraisalPriceError, #emailError { color: red; }
        .active { display: block; }
    </style>
</head>
<body>
    <nav>
        <a href="#" onclick="showSection('stress-test'); return false;">Stress Test</a>
        <a href="#" onclick="showSection('about-us'); return false;">About Us</a>
        <a href="#" onclick="showSection('privacy'); return false;">Privacy</a>
        <a href="#" onclick="showSection('terms'); return false;">Terms</a>
    </nav>
    <div class="content">
        <div id="stress-test" class="section active">
            <h2>Real Estate Stress Test</h2>
            <form id="stressTestForm">
                <div class="form-group">
                    <label for="email">Email <span style="color: red;">*</span>:</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    <label for="postalCode">Postal Code:</label>
                    <input type="text" id="postalCode" name="postalCode" placeholder="e.g., M5V 2T6" required>
                    <label for="appraisalPrice">Appraisal Price ($):</label>
                    <input type="number" id="appraisalPrice" name="appraisalPrice" placeholder="e.g., 500000" required>
                    <label for="propertyCategory">Property Type:</label>
                    <select id="propertyCategory" name="propertyCategory" required>
                        <option value="">Select Property Type</option>
                        <option value="Condo">Condo</option>
                        <option value="House">House</option>
                        <option value="Townhouse">Townhouse</option>
                        <option value="Apartment">Apartment</option>
                        <option value="Duplex">Duplex</option>
                    </select>
                    <label for="province">Province:</label>
                    <select id="province" name="province" required>
                        <option value="">Select Province</option>
                        <option value="Ontario">Ontario</option>
                        <option value="British Columbia">British Columbia</option>
                        <option value="Alberta">Alberta</option>
                        <option value="Quebec">Quebec</option>
                        <option value="Manitoba">Manitoba</option>
                        <option value="Saskatchewan">Saskatchewan</option>
                        <option value="Nova Scotia">Nova Scotia</option>
                        <option value="New Brunswick">New Brunswick</option>
                        <option value="Newfoundland and Labrador">Newfoundland and Labrador</option>
                        <option value="Prince Edward Island">Prince Edward Island</option>
                        <option value="Northwest Territories">Northwest Territories</option>
                        <option value="Yukon">Yukon</option>
                        <option value="Nunavut">Nunavut</option>
                    </select>
                    <label for="bedrooms">Bedrooms:</label>
                    <input type="number" id="bedrooms" name="bedrooms" placeholder="e.g., 2" required>
                    <label for="bathrooms">Bathrooms:</label>
                    <input type="number" id="bathrooms" name="bathrooms" placeholder="e.g., 1.5" required>
                    <label for="squareFootage">Square Footage:</label>
                    <input type="number" id="squareFootage" name="squareFootage" placeholder="e.g., 1200" required>
                    <label for="location">Location:</label>
                    <input type="text" id="location" name="location" placeholder="e.g., Downtown Toronto" required>
                    <button type="submit">Submit</button>
                </div>
                <div id="postalCodeError"></div>
                <div id="appraisalPriceError"></div>
                <div id="emailError"></div>
            </form>
            <div id="payment" style="display: none;">
                <h3>Complete Payment to Receive Results</h3>
                <p>Pay <span class="price-highlight">$19.99 CAD</span> (regular price: <s>$39.99 CAD</s>, limited time offer) to receive your assessment.</p>
                <div id="checkout-message"></div>
                <button id="sendForProcessing">Send for Processing</button>
            </div>
        </div>
        <div id="about-us" class="section">
            <h2>About Us</h2>
            <p>We are a team dedicated to providing real estate stress testing tools to help you assess property value trends. Our goal is to offer simple, reliable insights for your investment decisions.</p>
        </div>
        <div id="privacy" class="section">
            <h2>Privacy</h2>
            <p>Your email and property data are used solely to deliver your stress test results. We do not share your information with third parties. By using this service, you agree to our data handling practices.</p>
        </div>
        <div id="terms" class="section">
            <h2>Terms</h2>
            <p>This service is provided "as is" for informational purposes only. Payment of $19.99 CAD is required to receive results. We are not liable for investment decisions based on these estimates.</p>
        </div>
    </div>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('stressTestForm');
            const paymentDiv = document.getElementById('payment');
            const sendForProcessing = document.getElementById('sendForProcessing');

            if (form && paymentDiv) {
                form.style.display = 'block';

                function calculateResults(data) {
                    if (!data.email) {
                        return { error: "Email is required to receive results." };
                    }
                    const marketData = {
                        nationalTrends: { priceChangeAnnual: -0.015, salesDrop: 0.03, unsoldInventory: 0.05, basePrice: 679 },
                        policyImpact: { interestRate: 0.0275, economicUncertainty: 0.02 },
                        weights: { priceChange: 0.4, salesDrop: 0.3, unsoldInventory: 0.2, policyImpact: 0.1 },
                        postalCodeFactors: { 'M5V': 0.995, 'V6B': 0.99, 'H3B': 1.00, 'T2P': 0.98, 'B3J': 0.97, 'L0A': 0.99 }
                    };
                    const postalCodePrefix = data.postalCode.toUpperCase().replace(/\s/g, '').slice(0, 3);
                    const postalFactor = marketData.postalCodeFactors[postalCodePrefix] || 1.0;
                    const nationalData = marketData.nationalTrends;
                    const sentimentScore = (nationalData.priceChangeAnnual * marketData.weights.priceChange) +
                                          (nationalData.salesDrop * marketData.weights.salesDrop * -1) +
                                          (nationalData.unsoldInventory * marketData.weights.unsoldInventory * -1) +
                                          (marketData.policyImpact.economicUncertainty * marketData.weights.policyImpact * -1);
                    const adjustedGrowthRate = Math.max(Math.min(sentimentScore * 0.5, 0.02), -0.02);
                    const currentValue = parseFloat(data.appraisalPrice);
                    const projectedValue = currentValue * (1 + adjustedGrowthRate);
                    const percentageChange = ((projectedValue - currentValue) / currentValue) * 100;

                    let increaseChance, declineChance, outlook;
                    if (percentageChange < -2) {
                        declineChance = 60; increaseChance = 40;
                        outlook = `Expected value decrease of ${(-percentageChange).toFixed(1)}% over 2 years due to market conditions.`;
                    } else if (percentageChange > 2) {
                        increaseChance = 60; declineChance = 40;
                        outlook = `Expected value increase of ${percentageChange.toFixed(1)}% over 2 years, though tempered by risks.`;
                    } else {
                        increaseChance = 50; declineChance = 50;
                        outlook = `Value expected to remain stable (Â±2%) over 2 years, reflecting current market trends.`;
                    }

                    return {
                        fullResult: `
                            Your Stress Test Results:
                            Email: ${data.email}
                            Current Value: $${currentValue.toLocaleString()}
                            Projected Value (2 Years): $${projectedValue.toLocaleString()}
                            2-Year Outlook: ${outlook}
                            Price Movement Probability: ${increaseChance}% chance of increase, ${declineChance}% chance of decline
                            Location: ${data.location} (Postal Code: ${data.postalCode})
                            Property Type: ${data.propertyCategory}
                            Province: ${data.province}
                            Please save these results for your records.
                        `
                    };
                }

                form.onsubmit = function(event) {
                    event.preventDefault();
                    const formData = {
                        email: document.getElementById('email').value,
                        postalCode: document.getElementById('postalCode').value,
                        appraisalPrice: document.getElementById('appraisalPrice').value,
                        propertyCategory: document.getElementById('propertyCategory').value,
                        province: document.getElementById('province').value,
                        bedrooms: document.getElementById('bedrooms').value,
                        bathrooms: document.getElementById('bathrooms').value,
                        squareFootage: document.getElementById('squareFootage').value,
                        location: document.getElementById('location').value
                    };
                    if (!formData.email) {
                        document.getElementById('emailError').textContent = 'Email is required to receive results.';
                        return;
                    }
                    if (!formData.postalCode.match(/[A-Za-z]\d[A-Za-z]\s?\d[A-Za-z]\d/)) {
                        document.getElementById('postalCodeError').textContent = 'Please enter a valid Canadian postal code (e.g., M5V 2T6).';
                        return;
                    }
                    if (!formData.appraisalPrice || formData.appraisalPrice <= 0 || !formData.squareFootage || formData.squareFootage <= 0) {
                        document.getElementById('appraisalPriceError').textContent = 'Please enter positive numbers for appraisal price and square footage.';
                        return;
                    }
                    const { fullResult, error } = calculateResults(formData);
                    if (error) {
                        document.getElementById('emailError').textContent = error;
                        return;
                    }
                    localStorage.setItem('fullResult', fullResult);
                    form.style.display = 'none';
                    paymentDiv.style.display = 'block';
                    sendForProcessing.onclick = function() {
                        const subject = 'Stress Test Result';
                        const body = `Please process my payment and send the full results. ${fullResult}`;
                        window.location.href = `mailto:catalystcg@outlook.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    };
                };

                document.getElementById('checkout-button').addEventListener('click', () => {
                    const formData = {
                        email: document.getElementById('email').value,
                        postalCode: document.getElementById('postalCode').value,
                        appraisalPrice: document.getElementById('appraisalPrice').value,
                        propertyCategory: document.getElementById('propertyCategory').value,
                        province: document.getElementById('province').value,
                        bedrooms: document.getElementById('bedrooms').value,
                        bathrooms: document.getElementById('bathrooms').value,
                        squareFootage: document.getElementById('squareFootage').value,
                        location: document.getElementById('location').value
                    };
                    const session = window.open(`https://buy.stripe.com/xyz?prefilled_email=${encodeURIComponent(formData.email)}`, '_blank');
                    if (session) {
                        setTimeout(() => paymentDiv.style.display = 'none', 2000); // Simulate payment
                    }
                });
            }
        });
    </script>
</body>
</html>
