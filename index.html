<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate Stress Tester</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .welcome { margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input, select { width: 100%; padding: 8px; margin-bottom: 10px; }
    button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    #results { margin-top: 20px; padding: 20px; border: 1px solid #ccc; display: none; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="welcome">
    <h1>Welcome to the Real Estate Stress Tester</h1>
    <p>Unlike traditional appraisals costing $500–$700, our stress test provides dynamic insights into future price trends for just a fraction of the cost. Understand your property’s potential with data-driven precision. Get started now!</p>
  </div>

  <form id="stressTestForm">
    <div class="form-group">
      <label for="country">Country</label>
      <select id="country" required>
        <option value="">Select Country</option>
        <option value="Canada">Canada</option>
        <option value="Australia">Australia</option>
      </select>
    </div>
    <div class="form-group">
      <label for="location">Location (City/Town)</label>
      <input type="text" id="location" required>
    </div>
    <div class="form-group">
      <label for="postalCode">Postal Code/Postcode</label>
      <input type="text" id="postalCode" required>
    </div>
    <div class="form-group">
      <label for="propertyType">Property Type</label>
      <select id="propertyType" required>
        <option value="">Select Property Type</option>
        <option value="House">House</option>
        <option value="Condo">Condo</option>
        <option value="Townhouse">Townhouse</option>
      </select>
    </div>
    <div class="form-group">
      <label for="region">Region</label>
      <select id="region" required>
        <option value="">Select Region</option>
        <!-- Canada -->
        <option value="Alberta" class="canada">Alberta</option>
        <option value="British Columbia" class="canada">British Columbia</option>
        <option value="Manitoba" class="canada">Manitoba</option>
        <option value="New Brunswick" class="canada">New Brunswick</option>
        <option value="Newfoundland and Labrador" class="canada">Newfoundland and Labrador</option>
        <option value="Nova Scotia" class="canada">Nova Scotia</option>
        <option value="Ontario" class="canada">Ontario</option>
        <option value="Prince Edward Island" class="canada">Prince Edward Island</option>
        <option value="Quebec" class="canada">Quebec</option>
        <option value="Saskatchewan" class="canada">Saskatchewan</option>
        <option value="Northwest Territories" class="canada">Northwest Territories</option>
        <option value="Nunavut" class="canada">Nunavut</option>
        <option value="Yukon" class="canada">Yukon</option>
        <!-- Australia -->
        <option value="New South Wales" class="australia">New South Wales</option>
        <option value="Victoria" class="australia">Victoria</option>
        <option value="Queensland" class="australia">Queensland</option>
        <option value="Western Australia" class="australia">Western Australia</option>
        <option value="South Australia" class="australia">South Australia</option>
        <option value="Tasmania" class="australia">Tasmania</option>
        <option value="Australian Capital Territory" class="australia">Australian Capital Territory</option>
        <option value="Northern Territory" class="australia">Northern Territory</option>
      </select>
    </div>
    <button type="submit">Run Stress Test</button>
    <p id="error" class="error"></p>
  </form>

  <div id="results">
    <h2>Stress Test Results</h2>
    <p id="resultOutput"></p>
  </div>

  <script>
    // Daily data object (updated daily via external script)
    const dailyData = {
      "date": "2025-06-13",
      "data": [
        {
          "country": "Canada",
          "postalCode": "L0A 1G0",
          "location": "Millbrook",
          "region": "Ontario",
          "propertyType": "House",
          "stressTestMetrics": {
            "currentValue": 890000,
            "projectedValue2Years": 877985,
            "twoYearOutlook": "Value expected to remain stable (±2%) over 2 years, reflecting current market trends.",
            "priceMovementProbability": {
              "increase": 50,
              "decline": 50
            },
            "postalCodePriceTrend": {
              "localGrowth": 2.0,
              "regionalGrowth": 3.5,
              "description": "Over the past 12 months, house prices in L0A 1G0 have grown by approximately 2%, slightly below the Ontario average of 3.5%. This slower growth reflects Millbrook’s rural setting, which offers stability but less speculative demand compared to urban areas."
            },
            "localDemandDrivers": {
              "description": "Millbrook’s appeal as a rural community, with proximity to Peterborough (30 km) and the Greater Toronto Area (100 km), attracts remote workers and retirees seeking affordability. Limited new development preserves low inventory, supporting price stability.",
              "populationGrowth": 1.2,
              "infrastructure": "No major projects announced; stable rural infrastructure."
            },
            "vulnerabilities": [
              "Rising interest rates (2.75% current impact) could pose a moderate risk.",
              "Slower population growth in rural areas may limit demand compared to urban centers."
            ],
            "factorsForIncrease": [
              "Falling interest rates (potential decrease from 2.75%) could provide a slight uplift.",
              "Continued demand for rural properties as hybrid work persists may enhance Millbrook’s appeal."
            ]
          },
          "source": [
            {"name": "CREA", "url": "stats.crea.ca", "lastUpdated": "2025-05-15"},
            {"name": "Statistics Canada", "url": "www.statcan.gc.ca", "lastUpdated": "2025-03-31"},
            {"name": "CMHC", "url": "www.cmhc-schl.gc.ca", "lastUpdated": "2025-04-30"}
          ]
        },
        {
          "country": "Australia",
          "postcode": "2000",
          "location": "Sydney",
          "region": "New South Wales",
          "propertyType": "House",
          "stressTestMetrics": {
            "currentValue": 1500000,
            "projectedValue2Years": 1575000,
            "twoYearOutlook": "Value expected to grow slightly (+5%) over 2 years, driven by strong urban demand.",
            "priceMovementProbability": {
              "increase": 60,
              "decline": 40
            },
            "postalCodePriceTrend": {
              "localGrowth": 3.0,
              "regionalGrowth": 4.0,
              "description": "Over the past 12 months, house prices in postcode 2000 have grown by approximately 3%, slightly below the New South Wales average of 4%. This reflects Sydney’s high affordability constraints but sustained demand."
            },
            "localDemandDrivers": {
              "description": "Sydney’s status as a global city, with major infrastructure projects like the $12.5B Sydney Metro, drives demand. Strong population growth (1.6%) and low inventory support price growth.",
              "populationGrowth": 1.6,
              "infrastructure": "Sydney Metro City & Southwest project ($12.5B, completion 2024)."
            },
            "vulnerabilities": [
              "High interest rates (4.1% current impact) could limit affordability.",
              "Economic uncertainties from global tariffs may slow demand."
            ],
            "factorsForIncrease": [
              "Rate cuts (potential decrease from 4.1%) could boost buyer confidence.",
              "Infrastructure projects and population growth sustain long-term demand."
            ]
          },
          "source": [
            {"name": "CoreLogic", "url": "www.corelogic.com.au", "lastUpdated": "2025-06-04"},
            {"name": "ABS", "url": "www.abs.gov.au", "lastUpdated": "2025-03-31"},
            {"name": "Domain", "url": "www.domain.com.au", "lastUpdated": "2025-06-01"}
          ]
        }
      ]
    };

    // Filter regions based on country selection
    const countrySelect = document.getElementById('country');
    const regionSelect = document.getElementById('region');
    const form = document.getElementById('stressTestForm');
    const error = document.getElementById('error');
    const results = document.getElementById('results');
    const resultOutput = document.getElementById('resultOutput');

    countrySelect.addEventListener('change', () => {
      const country = countrySelect.value;
      const options = regionSelect.querySelectorAll('option');
      options.forEach(option => {
        if (option.value === '') return;
        option.style.display = (country === 'Canada' && option.classList.contains('canada')) ||
                              (country === 'Australia' && option.classList.contains('australia')) ? 'block' : 'none';
        if (option.style.display === 'none') option.selected = false;
      });
    });

    // Validate postal code/postcode
    function validatePostalCode(postalCode, country) {
      if (country === 'Canada') {
        const regex = /^[A-Za-z]\d[A-Za-z] ?\d[A-Za-z]\d$/;
        return regex.test(postalCode);
      } else if (country === 'Australia') {
        const regex = /^\d{4}$/;
        return regex.test(postalCode);
      }
      return false;
    }

    // Run stress test using daily data
    function runStressTest(data) {
      // Find matching data entry
      const entry = dailyData.data.find(item =>
        item.country === data.country &&
        (item.country === 'Canada' ? item.postalCode : item.postcode) === data.postalCode &&
        item.location.toLowerCase() === data.location.toLowerCase() &&
        item.region === data.region &&
        item.propertyType === data.propertyType
      );

      if (!entry) {
        return "No data available for the specified location and property type. Please try another input.";
      }

      const metrics = entry.stressTestMetrics;
      // Format result
      return `
Current Value: $${metrics.currentValue.toLocaleString()}
Projected Value (2 Years): $${metrics.projectedValue2Years.toLocaleString()}
2-Year Outlook: ${metrics.twoYearOutlook}
Price Movement Probability: ${metrics.priceMovementProbability.increase}% chance of increase, ${metrics.priceMovementProbability.decline}% chance of decline
Location: ${entry.location} (${data.country === 'Canada' ? entry.postalCode : entry.postcode})
Property Type: ${entry.propertyType}
Region: ${entry.region}
Postal Code Price Trend: ${metrics.postalCodePriceTrend.description}
Local Demand Drivers: ${metrics.localDemandDrivers.description}
Major Vulnerabilities to Price Decline:
- ${metrics.vulnerabilities[0]}
- ${metrics.vulnerabilities[1]}
Major Factors for Price Increase:
- ${metrics.factorsForIncrease[0]}
- ${metrics.factorsForIncrease[1]}
Sources:
- ${entry.source.map(s => `${s.name} (${s.lastUpdated})`).join('\n- ')}
      `;
    }

    form.onsubmit = function(e) {
      e.preventDefault();
      error.textContent = '';
      results.style.display = 'none';

      const data = {
        country: countrySelect.value,
        location: document.getElementById('location').value,
        postalCode: document.getElementById('postalCode').value.trim(),
        propertyType: document.getElementById('propertyType').value,
        region: regionSelect.value
      };

      // Validate inputs
      if (!data.country || !data.location || !data.postalCode || !data.propertyType || !data.region) {
        error.textContent = 'Please fill out all fields.';
        return;
      }

      if (!validatePostalCode(data.postalCode, data.country)) {
        error.textContent = `Invalid ${data.country === 'Canada' ? 'postal code' : 'postcode'} for ${data.country}.`;
        return;
      }

      // Redirect to Stripe payment link (replace with your actual test mode URL)
      const stripeLink = 'https://buy.stripe.com/test_3cI6op3Ga7U20OY4dNa7C00';
      window.location.href = stripeLink;

      // Simulate stress test result (uncomment for testing without payment)
      /*
      const result = runStressTest(data);
      resultOutput.textContent = result;
      results.style.display = 'block';
      */
    };
  </script>
</body>
</html>
