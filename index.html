<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate Stress Tester</title>
  <style>
    /* General styling for the body */
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* Container for the entire content */
    .container {
      max-width: 600px;
      width: 100%;
      background-color: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    /* Welcome section styling */
    .welcome {
      text-align: center;
      margin-bottom: 20px;
    }

    .welcome h1 {
      font-size: 24px;
      color: #333;
    }

    .welcome p {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
    }

    /* Form styling */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #333;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    /* Country selection styling (simplified from tabs) */
    #country {
      margin-bottom: 15px;
    }

    /* Button styling */
    button[type="submit"] {
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    button[type="submit"]:hover {
      background-color: #0056b3;
    }

    /* Results styling */
    #results {
      margin-top: 20px;
      padding: 20px;
      background-color: #e6ffe6;
      border: 1px solid #ccc;
      border-radius: 4px;
      display: none;
    }

    #results h2 {
      font-size: 20px;
      color: #333;
      margin-bottom: 10px;
    }

    #resultOutput {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
    }

    /* Error styling */
    .error {
      color: red;
      font-size: 12px;
      margin-top: 5px;
    }

    /* Additional padding for consistency */
    .container > * {
      padding: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="welcome">
      <h1>Welcome to Your Real Estate Stress Test!</h1>
      <p>Step into a smarter way to assess your property’s future! Unlike traditional appraisals—costing $500–$700 in Canada and Australia—the Real Estate Stress Test offers a dynamic, 24-month outlook based on current market trends and economic indicators, all at a fraction of the price. This powerful tool empowers you with actionable insights, outlining static appraisals by predicting value changes and risks. Ready to take control? Simply select your market (Canada or Australia), fill in your property details, and get your personalized stress test started today!</p>
    </div>

    <form id="stressTestForm">
      <div class="form-group">
        <label for="country">Country</label>
        <select id="country" required>
          <option value="">Select Country</option>
          <option value="Canada">Canada</option>
          <option value="Australia">Australia</option>
        </select>
      </div>
      <div class="form-group">
        <label for="email">Email *</label>
        <input type="email" id="email" required placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label for="region">Province / State / Territory</label>
        <select id="region" required>
          <option value="">Select Region</option>
          <!-- Canada -->
          <option value="Alberta" class="canada">Alberta</option>
          <option value="British Columbia" class="canada">British Columbia</option>
          <option value="Manitoba" class="canada">Manitoba</option>
          <option value="New Brunswick" class="canada">New Brunswick</option>
          <option value="Newfoundland and Labrador" class="canada">Newfoundland and Labrador</option>
          <option value="Nova Scotia" class="canada">Nova Scotia</option>
          <option value="Ontario" class="canada">Ontario</option>
          <option value="Prince Edward Island" class="canada">Prince Edward Island</option>
          <option value="Quebec" class="canada">Quebec</option>
          <option value="Saskatchewan" class="canada">Saskatchewan</option>
          <option value="Northwest Territories" class="canada">Northwest Territories</option>
          <option value="Nunavut" class="canada">Nunavut</option>
          <option value="Yukon" class="canada">Yukon</option>
          <!-- Australia -->
          <option value="New South Wales" class="australia">New South Wales</option>
          <option value="Victoria" class="australia">Victoria</option>
          <option value="Queensland" class="australia">Queensland</option>
          <option value="Western Australia" class="australia">Western Australia</option>
          <option value="South Australia" class="australia">South Australia</option>
          <option value="Tasmania" class="australia">Tasmania</option>
          <option value="Australian Capital Territory" class="australia">Australian Capital Territory</option>
          <option value="Northern Territory" class="australia">Northern Territory</option>
        </select>
      </div>
      <div class="form-group">
        <label for="postalCode">Postal Code / Postcode</label>
        <input type="text" id="postalCode" required placeholder="e.g., 2000">
      </div>
      <div class="form-group">
        <label for="appraisalPrice">Appraisal Price ($)</label>
        <input type="number" id="appraisalPrice" required placeholder="e.g., 500000">
      </div>
      <div class="form-group">
        <label for="propertyType">Property Type</label>
        <select id="propertyType" required>
          <option value="">Select Property Type</option>
          <option value="House">House</option>
          <option value="Condo">Condo</option>
          <option value="Townhouse">Townhouse</option>
        </select>
      </div>
      <div class="form-group">
        <label for="bedrooms">Bedrooms</label>
        <input type="number" id="bedrooms" required placeholder="e.g., 2">
      </div>
      <div class="form-group">
        <label for="bathrooms">Bathrooms</label>
        <input type="number" id="bathrooms" required placeholder="e.g., 1.5">
      </div>
      <div class="form-group">
        <label for="squareFootage">Square Footage</label>
        <input type="number" id="squareFootage" required placeholder="e.g., 1200">
      </div>
      <div class="form-group">
        <label for="location">Location</label>
        <input type="text" id="location" required placeholder="e.g., Downtown Toronto or Sydney CBD">
      </div>
      <button type="submit">Proceed to Payment</button>
      <p id="error" class="error"></p>
    </form>

    <div id="results">
      <h2>Your Stress Test Results</h2>
      <p id="resultOutput"></p>
    </div>
  </div>

  <script>
    // Initialize variables
    const form = document.getElementById('stressTestForm');
    const error = document.getElementById('error');
    const results = document.getElementById('results');
    const resultOutput = document.getElementById('resultOutput');
    const countrySelect = document.getElementById('country');
    const regionSelect = document.getElementById('region');

    // Filter regions based on country selection
    countrySelect.addEventListener('change', () => {
      const country = countrySelect.value;
      const options = regionSelect.querySelectorAll('option');
      options.forEach(option => {
        if (option.value === '') return;
        option.style.display = (country === 'Canada' && option.classList.contains('canada')) ||
                              (country === 'Australia' && option.classList.contains('australia')) ? 'block' : 'none';
        if (option.style.display === 'none') option.selected = false;
      });
    });

    // Validate postal code/postcode
    function validatePostalCode(postalCode, country) {
      if (country === 'Canada') {
        const regex = /^[A-Za-z]\d[A-Za-z] ?\d[A-Za-z]\d$/;
        return regex.test(postalCode);
      } else if (country === 'Australia') {
        const regex = /^\d{4}$/;
        return regex.test(postalCode);
      }
      return false;
    }

    // Daily data object (updated daily via external script)
    const dailyData = {
      "date": "2025-06-13",
      "data": [
        {
          "country": "Canada",
          "postalCode": "L0A 1G0",
          "location": "Millbrook",
          "region": "Ontario",
          "propertyType": "House",
          "bedrooms": 3,
          "bathrooms": 2,
          "squareFootage": 1500,
          "appraisalPrice": 890000,
          "stressTestMetrics": {
            "currentValue": 890000,
            "projectedValue2Years": 877985,
            "twoYearOutlook": "Value expected to remain stable (±2%) over 2 years, reflecting current market trends.",
            "priceMovementProbability": {
              "increase": 50,
              "decline": 50
            },
            "postalCodePriceTrend": {
              "description": "Over the past 12 months, house prices in L0A 1G0 have grown by approximately 2%, slightly below the Ontario average of 3.5%. This slower growth reflects Millbrook’s rural setting, which offers stability but less speculative demand compared to urban areas."
            },
            "localDemandDrivers": {
              "description": "Millbrook’s appeal as a rural community, with proximity to Peterborough (30 km) and the Greater Toronto Area (100 km), attracts remote workers and retirees seeking affordability. Limited new development preserves low inventory, supporting price stability."
            },
            "vulnerabilities": [
              "Rising interest rates (2.75% current impact) could pose a moderate risk.",
              "Slower population growth in rural areas may limit demand compared to urban centers."
            ],
            "factorsForIncrease": [
              "Falling interest rates (potential decrease from 2.75%) could provide a slight uplift.",
              "Continued demand for rural properties as hybrid work persists may enhance Millbrook’s appeal."
            ]
          },
          "source": [
            {"name": "CREA", "url": "stats.crea.ca", "lastUpdated": "2025-05-15"},
            {"name": "Statistics Canada", "url": "www.statcan.gc.ca", "lastUpdated": "2025-03-31"},
            {"name": "CMHC", "url": "www.cmhc-schl.gc.ca", "lastUpdated": "2025-04-30"}
          ]
        },
        {
          "country": "Australia",
          "postcode": "2000",
          "location": "Sydney",
          "region": "New South Wales",
          "propertyType": "House",
          "bedrooms": 3,
          "bathrooms": 2,
          "squareFootage": 1800,
          "appraisalPrice": 1500000,
          "stressTestMetrics": {
            "currentValue": 1500000,
            "projectedValue2Years": 1575000,
            "twoYearOutlook": "Value expected to grow slightly (+5%) over 2 years, driven by strong urban demand.",
            "priceMovementProbability": {
              "increase": 60,
              "decline": 40
            },
            "postalCodePriceTrend": {
              "description": "Over the past 12 months, house prices in postcode 2000 have grown by approximately 3%, slightly below the New South Wales average of 4%. This reflects Sydney’s high affordability constraints but sustained demand."
            },
            "localDemandDrivers": {
              "description": "Sydney’s status as a global city, with major infrastructure projects like the $12.5B Sydney Metro, drives demand. Strong population growth (1.6%) and low inventory support price growth."
            },
            "vulnerabilities": [
              "High interest rates (4.1% current impact) could limit affordability.",
              "Economic uncertainties from global tariffs may slow demand."
            ],
            "factorsForIncrease": [
              "Rate cuts (potential decrease from 4.1%) could boost buyer confidence.",
              "Infrastructure projects and population growth sustain long-term demand."
            ]
          },
          "source": [
            {"name": "CoreLogic", "url": "www.corelogic.com.au", "lastUpdated": "2025-06-04"},
            {"name": "ABS", "url": "www.abs.gov.au", "lastUpdated": "2025-03-31"},
            {"name": "Domain", "url": "www.domain.com.au", "lastUpdated": "2025-06-01"}
          ]
        }
      ]
    };

    // Run stress test using daily data
    function runStressTest(data) {
      const entry = dailyData.data.find(item =>
        item.country === data.country &&
        (item.country === 'Canada' ? item.postalCode : item.postcode) === data.postalCode &&
        item.location.toLowerCase() === data.location.toLowerCase() &&
        item.region === data.region &&
        item.propertyType === data.propertyType &&
        item.bedrooms === parseInt(data.bedrooms) &&
        item.bathrooms === parseFloat(data.bathrooms) &&
        item.squareFootage === parseInt(data.squareFootage) &&
        Math.abs(item.appraisalPrice - parseInt(data.appraisalPrice)) < 1000
      );

      if (!entry) {
        return "No data available for the specified location and property details. Please try another input.";
      }

      const metrics = entry.stressTestMetrics;
      return `
Current Value: $${metrics.currentValue.toLocaleString()}
Projected Value (2 Years): $${metrics.projectedValue2Years.toLocaleString()}
2-Year Outlook: ${metrics.twoYearOutlook}
Price Movement Probability: ${metrics.priceMovementProbability.increase}% chance of increase, ${metrics.priceMovementProbability.decline}% chance of decline
Location: ${entry.location} (${data.country === 'Canada' ? entry.postalCode : entry.postcode})
Property Type: ${entry.propertyType}
Region: ${entry.region}
Major Vulnerabilities to Price Decline:
- ${metrics.vulnerabilities[0]}
- ${metrics.vulnerabilities[1]}
Major Factors for Price Increase:
- ${metrics.factorsForIncrease[0]}
- ${metrics.factorsForIncrease[1]}
Additional Observations:
- ${metrics.postalCodePriceTrend.description}
- ${metrics.localDemandDrivers.description}
Sources:
- ${entry.source.map(s => `${s.name} (${s.lastUpdated})`).join('\n- ')}
      `;
    }

    // Form submission handler
    form.onsubmit = function(e) {
      e.preventDefault();
      error.textContent = '';
      results.style.display = 'none';

      const data = {
        country: countrySelect.value,
        email: document.getElementById('email').value,
        region: document.getElementById('region').value,
        postalCode: document.getElementById('postalCode').value.trim(),
        appraisalPrice: document.getElementById('appraisalPrice').value,
        propertyType: document.getElementById('propertyType').value,
        bedrooms: document.getElementById('bedrooms').value,
        bathrooms: document.getElementById('bathrooms').value,
        squareFootage: document.getElementById('squareFootage').value,
        location: document.getElementById('location').value
      };

      // Validate inputs
      if (!data.country || !data.email || !data.region || !data.postalCode || !data.appraisalPrice || !data.propertyType || !data.bedrooms || !data.bathrooms || !data.squareFootage || !data.location) {
        error.textContent = 'Please fill out all fields.';
        return;
      }

      if (!validatePostalCode(data.postalCode, data.country)) {
        error.textContent = `Invalid ${data.country === 'Canada' ? 'postal code' : 'postcode'} for ${data.country}.`;
        return;
      }

      // Store form data in sessionStorage for post-payment retrieval
      sessionStorage.setItem('stressTestData', JSON.stringify(data));

      // Redirect to Stripe payment link with success callback
      const stripeLink = 'https://buy.stripe.com/test_3cI6op3Ga7U20OY4dNa7C00?success=true';
      window.location.href = stripeLink;
    };

    // Check for payment success on page load
    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('success') === 'true') {
        const savedData = JSON.parse(sessionStorage.getItem('stressTestData'));
        if (savedData) {
          const result = runStressTest(savedData);
          resultOutput.textContent = result;
          results.style.display = 'block';
          // Clear sessionStorage after displaying results
          sessionStorage.removeItem('stressTestData');
        }
      }
    };
  </script>
</body>
</html>
